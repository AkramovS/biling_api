# üéâ JWT –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞!

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ —Å—Ç–∏–ª—é **Alex Edwards** –∏–∑ –∫–Ω–∏–≥–∏ "Let's Go Further".

## üì¶ –ß—Ç–æ —Å–æ–∑–¥–∞–Ω–æ

### ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)

- –¢–∞–±–ª–∏—Ü–∞ `users` - –±–∏–∑–Ω–µ—Å-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –¢–∞–±–ª–∏—Ü–∞ `accounts` - –ª–∏—Ü–µ–≤—ã–µ —Å—á–µ—Ç–∞
- –¢–∞–±–ª–∏—Ü–∞ `users_accounts` - —Å–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º
- –¢–∞–±–ª–∏—Ü–∞ `auth_users` - —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è –≤—Ö–æ–¥–∞
- –¢–∞–±–ª–∏—Ü–∞ `groups` - –≥—Ä—É–ø–ø—ã –¥–æ—Å—Ç—É–ø–∞
- –¢–∞–±–ª–∏—Ü–∞ `group_members` - —á–ª–µ–Ω—Å—Ç–≤–æ –≤ –≥—Ä—É–ø–ø–∞—Ö
- –¢–∞–±–ª–∏—Ü–∞ `group_permissions` - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è –≥—Ä—É–ø–ø

### ‚úÖ API Endpoints

- `GET /v1/health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
- `POST /v1/auth/register` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /v1/auth/login` - –≤—Ö–æ–¥ (–ø–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞)
- `GET /v1/users/:id/accounts` - –ø–æ–ª—É—á–∏—Ç—å –ª–∏—Ü–µ–≤—ã–µ —Å—á–µ—Ç–∞ (üîí —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ `accounts:read`)

### ‚úÖ JWT + RBAC

- JWT —Ç–æ–∫–µ–Ω—ã —Å –ø–æ–¥–ø–∏—Å—å—é HMAC-SHA256
- Bcrypt —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (cost 12)
- –ì—Ä—É–ø–ø—ã –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (Resource:Action)
- Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [README.md](file:///d:/Work/Biling_api/README.md) - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- [SETUP.md](file:///d:/Work/Biling_api/SETUP.md) - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- [Walkthrough](file:///C:/Users/sherk/.gemini/antigravity/brain/4ddc8f34-0770-4b3f-9542-f766bac337af/walkthrough.md) - –æ–±–∑–æ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å?

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**Windows PowerShell:**

```powershell
cd d:\Work\Biling_api
.\scripts\init.ps1
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. –°–æ–∑–¥–∞—Å—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `utm`
2. –ü—Ä–∏–º–µ–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
3. –î–æ–±–∞–≤–∏—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ API
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä—É—á–Ω—É—é

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –ë–î
createdb utm

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
psql utm < migrations/000001_create_tables.up.sql
psql utm < migrations/000002_seed_data.up.sql

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
go mod tidy
go run ./cmd/api
```

–ó–∞—Ç–µ–º –≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```bash
# –°–æ–∑–¥–∞—Ç—å admin
curl -X POST http://localhost:4000/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"password123"}'

# –°–æ–∑–¥–∞—Ç—å –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST http://localhost:4000/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"password123"}'

# –î–æ–±–∞–≤–∏—Ç—å admin –≤ –≥—Ä—É–ø–ø—É (ID –æ–±—ã—á–Ω–æ 1)
psql utm -c "INSERT INTO group_members (group_id, auth_user_id) VALUES (1, 1);"
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1Ô∏è‚É£ –í–æ–π—Ç–∏ –∫–∞–∫ admin

```bash
curl -X POST http://localhost:4000/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"password123"}'
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {"id": 1, "email": "admin@example.com"}
}
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω!

### 2Ô∏è‚É£ –ü–æ–ª—É—á–∏—Ç—å –ª–∏—Ü–µ–≤—ã–µ —Å—á–µ—Ç–∞ (admin ‚úÖ)

```bash
curl http://localhost:4000/v1/users/1/accounts \
  -H "Authorization: Bearer –í–ê–®_–¢–û–ö–ï–ù"
```

**–£—Å–ø–µ—Ö (200 OK):**

```json
{
  "user": {"id": 1, "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"},
  "accounts": [
    {"id": 1, "name": "–õ–∏—Ü–µ–≤–æ–π —Å—á–µ—Ç 10001"},
    {"id": 2, "name": "–õ–∏—Ü–µ–≤–æ–π —Å—á–µ—Ç 10002"},
    {"id": 3, "name": "–õ–∏—Ü–µ–≤–æ–π —Å—á–µ—Ç 10003"}
  ]
}
```

### 3Ô∏è‚É£ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (‚ùå)

```bash
# –í–æ–π—Ç–∏
curl -X POST http://localhost:4000/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"password123"}'

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–ª—É—á–∏—Ç—å —Å—á–µ—Ç–∞
curl http://localhost:4000/v1/users/1/accounts \
  -H "Authorization: Bearer –¢–û–ö–ï–ù_USER"
```

**–û—à–∏–±–∫–∞ (403 Forbidden):**

```json
{
  "error": "your user account doesn't have the necessary permissions to access this resource"
}
```

## üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã:

**–ë–∏–∑–Ω–µ—Å-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (5):**

- –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤ (3 —Å—á–µ—Ç–∞ + 1 –æ–±—â–∏–π)
- –ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞ (2 —Å—á–µ—Ç–∞)
- –°–µ—Ä–≥–µ–π –°–∏–¥–æ—Ä–æ–≤ (1 —Å—á–µ—Ç)
- –ê–Ω–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞ (4 —Å—á–µ—Ç–∞)
- –î–º–∏—Ç—Ä–∏–π –ö–æ–∑–ª–æ–≤ (0 —Å—á–µ—Ç–æ–≤)

**–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (2):**

- `admin@example.com` / `password123` ‚úÖ –í –≥—Ä—É–ø–ø–µ `api_users` ‚úÖ –î–æ—Å—Ç—É–ø –∫ API
- `user@example.com` / `password123` ‚ùå –ù–µ –≤ –≥—Ä—É–ø–ø–µ ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
d:\Work\Biling_api\
‚îú‚îÄ‚îÄ cmd/api/              –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ main.go          –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ routes.go        –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ middleware.go    JWT + RBAC –ø—Ä–æ–≤–µ—Ä–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ *_handlers.go    –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ helpers.go       –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ data/            –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_users.go   –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ groups.go       –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (RBAC)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tokens.go       JWT
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.go        –ë–∏–∑–Ω–µ—Å-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ accounts.go     –õ–∏—Ü–µ–≤—ã–µ —Å—á–µ—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ validator/       –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ migrations/          SQL –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ scripts/            –°–∫—Ä–∏–ø—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îî‚îÄ‚îÄ tools/              –£—Ç–∏–ª–∏—Ç—ã
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —Å bcrypt (cost 12)
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã HMAC-SHA256
- ‚úÖ –¢–æ–∫–µ–Ω—ã –¥–µ–π—Å—Ç–≤—É—é—Ç 24 —á–∞—Å–∞
- ‚úÖ Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω + –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ Database timeouts –∑–∞—â–∏—Ç–∞ –æ—Ç DoS

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- üìñ [README.md](file:///d:/Work/Biling_api/README.md) - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- üõ†Ô∏è [SETUP.md](file:///d:/Work/Biling_api/SETUP.md) - —É—Å—Ç–∞–Ω–æ–≤–∫–∞

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ API endpoints
3. –ò–∑—É—á–∏—Ç–µ –∫–æ–¥ –≤ `internal/data/` –∏ `cmd/api/`
4. –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ endpoints –ø–æ —Ç–æ–º—É –∂–µ –ø–∞—Ç—Ç–µ—Ä–Ω—É!

**–ì–æ—Ç–æ–≤–æ!** üéâ

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç. –¢–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –≤—ã (–∏–ª–∏ admin –≤ –≥—Ä—É–ø–ø–µ) –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ª–∏—Ü–µ–≤—ã–º —Å—á–µ—Ç–∞–º!
